

<!DOCTYPE html>
<html class="writer-html5" lang="uk" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>app.crud.users &mdash; Contact Management API 2.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../_static/custom.css?v=5ee4f644" />
      <link rel="stylesheet" type="text/css" href="../../../_static/custom.css?v=5ee4f644" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=f91dff7e"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="–Ü–Ω–¥–µ–∫—Å" href="../../../genindex.html" />
    <link rel="search" title="–ü–æ—à—É–∫" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            Contact Management API
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">üöÄ API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api/index.html">API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api/authentication.html">–ê—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/authentication.html#id1">–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/authentication.html#id2">–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/authentication.html#id3">–í—Ö—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/authentication.html#email">–í–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—è Email</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/authentication.html#id4">–ü–æ–≤—Ç–æ—Ä–Ω–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∞ –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—ó</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/authentication.html#id5">–°–∫–∏–¥–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—è</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/users.html">–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/users.html#id1">–û—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/users.html#id2">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∞–≤–∞—Ç–∞—Ä–∞</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/users.html#id3">–ó–º—ñ–Ω–∞ —Ä–æ–ª—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/contacts.html">–ö–æ–Ω—Ç–∞–∫—Ç–∏ API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/contacts.html#id1">–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ–Ω—Ç–∞–∫—Ç—É</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/contacts.html#id2">–û—Ç—Ä–∏–º–∞–Ω–Ω—è —Å–ø–∏—Å–∫—É –∫–æ–Ω—Ç–∞–∫—Ç—ñ–≤</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/contacts.html#id">–û—Ç—Ä–∏–º–∞–Ω–Ω—è –∫–æ–Ω—Ç–∞–∫—Ç—É –∑–∞ ID</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/contacts.html#id3">–û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–Ω—Ç–∞–∫—Ç—É</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/contacts.html#id4">–í–∏–¥–∞–ª–µ–Ω–Ω—è –∫–æ–Ω—Ç–∞–∫—Ç—É</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/contacts.html#id5">–î–Ω—ñ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/index.html#id1">–ó–∞–≥–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/index.html#base-url">Base URL</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/index.html#id2">–í–µ—Ä—Å—ñ–æ–Ω—É–≤–∞–Ω–Ω—è API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/index.html#id3">–ê—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/index.html#id4">–§–æ—Ä–º–∞—Ç –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/index.html#id5">–û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/authentication.html">–ê—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api/authentication.html#id1">–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/authentication.html#id2">–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/authentication.html#id3">–í—Ö—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/authentication.html#email">–í–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—è Email</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/authentication.html#id4">–ü–æ–≤—Ç–æ—Ä–Ω–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∞ –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—ó</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/authentication.html#id5">–°–∫–∏–¥–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—è</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/users.html">–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api/users.html#id1">–û—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/users.html#id2">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∞–≤–∞—Ç–∞—Ä–∞</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/users.html#id3">–ó–º—ñ–Ω–∞ —Ä–æ–ª—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/contacts.html">–ö–æ–Ω—Ç–∞–∫—Ç–∏ API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api/contacts.html#id1">–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ–Ω—Ç–∞–∫—Ç—É</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/contacts.html#id2">–û—Ç—Ä–∏–º–∞–Ω–Ω—è —Å–ø–∏—Å–∫—É –∫–æ–Ω—Ç–∞–∫—Ç—ñ–≤</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/contacts.html#id">–û—Ç—Ä–∏–º–∞–Ω–Ω—è –∫–æ–Ω—Ç–∞–∫—Ç—É –∑–∞ ID</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/contacts.html#id3">–û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–Ω—Ç–∞–∫—Ç—É</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/contacts.html#id4">–í–∏–¥–∞–ª–µ–Ω–Ω—è –∫–æ–Ω—Ç–∞–∫—Ç—É</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/contacts.html#id5">–î–Ω—ñ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">üìñ –ö–æ–¥ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/index.html">–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è –º–æ–¥—É–ª—ñ–≤</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/models.html">–ú–æ–¥–µ–ª—ñ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/models.html#app.models.users.UserRole"><code class="docutils literal notranslate"><span class="pre">UserRole</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/models.html#app.models.users.UserRole.USER"><code class="docutils literal notranslate"><span class="pre">UserRole.USER</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/models.html#app.models.users.UserRole.ADMIN"><code class="docutils literal notranslate"><span class="pre">UserRole.ADMIN</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/models.html#id0"><code class="docutils literal notranslate"><span class="pre">UserRole.USER</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/models.html#id2"><code class="docutils literal notranslate"><span class="pre">UserRole.ADMIN</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/models.html#app.models.users.User"><code class="docutils literal notranslate"><span class="pre">User</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/models.html#app.models.users.User.id"><code class="docutils literal notranslate"><span class="pre">User.id</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/models.html#app.models.users.User.username"><code class="docutils literal notranslate"><span class="pre">User.username</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/models.html#app.models.users.User.email"><code class="docutils literal notranslate"><span class="pre">User.email</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/models.html#app.models.users.User.hashed_password"><code class="docutils literal notranslate"><span class="pre">User.hashed_password</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/models.html#app.models.users.User.reset_password_token"><code class="docutils literal notranslate"><span class="pre">User.reset_password_token</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/models.html#app.models.users.User.reset_password_expires"><code class="docutils literal notranslate"><span class="pre">User.reset_password_expires</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/models.html#app.models.users.User.avatar_url"><code class="docutils literal notranslate"><span class="pre">User.avatar_url</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/models.html#app.models.users.User.is_verified"><code class="docutils literal notranslate"><span class="pre">User.is_verified</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/models.html#app.models.users.User.role"><code class="docutils literal notranslate"><span class="pre">User.role</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/models.html#app.models.users.User.verification_token"><code class="docutils literal notranslate"><span class="pre">User.verification_token</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/models.html#app.models.users.User.created_at"><code class="docutils literal notranslate"><span class="pre">User.created_at</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/models.html#app.models.users.User.updated_at"><code class="docutils literal notranslate"><span class="pre">User.updated_at</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/models.html#app.models.users.User.contacts"><code class="docutils literal notranslate"><span class="pre">User.contacts</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/models.html#id3"><code class="docutils literal notranslate"><span class="pre">User.contacts</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/models.html#app.models.users.User.is_admin"><code class="docutils literal notranslate"><span class="pre">User.is_admin()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/models.html#app.models.users.User.__repr__"><code class="docutils literal notranslate"><span class="pre">User.__repr__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/models.html#app.models.users.User.to_dict"><code class="docutils literal notranslate"><span class="pre">User.to_dict()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/models.html#enums">–ü–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω—è (Enums)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/models.html#id4"><code class="docutils literal notranslate"><span class="pre">UserRole</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/models.html#id9">–û—Å–Ω–æ–≤–Ω—ñ –º–æ–¥–µ–ª—ñ</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/models.html#id10">–ú–æ–¥–µ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/models.html#id29">–ú–æ–¥–µ–ª—å –∫–æ–Ω—Ç–∞–∫—Ç—É</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/crud.html">CRUD –æ–ø–µ—Ä–∞—Ü—ñ—ó</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/crud.html#module-app.crud.users">–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ CRUD</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/crud.html#app.crud.users.user_dict_to_model"><code class="docutils literal notranslate"><span class="pre">user_dict_to_model()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/crud.html#app.crud.users.user_model_to_dict"><code class="docutils literal notranslate"><span class="pre">user_model_to_dict()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/crud.html#app.crud.users.get_current_user"><code class="docutils literal notranslate"><span class="pre">get_current_user()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/crud.html#app.crud.users.get_current_verified_user"><code class="docutils literal notranslate"><span class="pre">get_current_verified_user()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/crud.html#app.crud.users.get_current_admin_user"><code class="docutils literal notranslate"><span class="pre">get_current_admin_user()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/crud.html#app.crud.users.require_role"><code class="docutils literal notranslate"><span class="pre">require_role()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/crud.html#app.crud.users.invalidate_user_cache"><code class="docutils literal notranslate"><span class="pre">invalidate_user_cache()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/crud.html#app.crud.users.get_user_by_email"><code class="docutils literal notranslate"><span class="pre">get_user_by_email()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/crud.html#app.crud.users.get_user_by_username"><code class="docutils literal notranslate"><span class="pre">get_user_by_username()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/crud.html#app.crud.users.get_user_by_id"><code class="docutils literal notranslate"><span class="pre">get_user_by_id()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/crud.html#app.crud.users.get_all_users"><code class="docutils literal notranslate"><span class="pre">get_all_users()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/crud.html#app.crud.users.create_user"><code class="docutils literal notranslate"><span class="pre">create_user()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/crud.html#app.crud.users.authenticate_user"><code class="docutils literal notranslate"><span class="pre">authenticate_user()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/crud.html#app.crud.users.verify_user_email"><code class="docutils literal notranslate"><span class="pre">verify_user_email()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/crud.html#app.crud.users.update_user"><code class="docutils literal notranslate"><span class="pre">update_user()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/crud.html#app.crud.users.update_user_role"><code class="docutils literal notranslate"><span class="pre">update_user_role()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/crud.html#app.crud.users.update_user_avatar"><code class="docutils literal notranslate"><span class="pre">update_user_avatar()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/crud.html#app.crud.users.create_password_reset_token"><code class="docutils literal notranslate"><span class="pre">create_password_reset_token()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/crud.html#app.crud.users.reset_user_password"><code class="docutils literal notranslate"><span class="pre">reset_user_password()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/crud.html#app.crud.users.verify_reset_token"><code class="docutils literal notranslate"><span class="pre">verify_reset_token()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/crud.html#id2">–ö–æ–Ω—Ç–∞–∫—Ç–∏ CRUD</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/crud.html#id3">–û—Å–Ω–æ–≤–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/crud.html#id4">–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/crud.html#id8">–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/services.html">–°–µ—Ä–≤—ñ—Å–∏</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/services.html#module-app.services.email">Email —Å–µ—Ä–≤—ñ—Å</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/services.html#app.services.email.send_verification_email"><code class="docutils literal notranslate"><span class="pre">send_verification_email()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/services.html#app.services.email.send_password_reset_email"><code class="docutils literal notranslate"><span class="pre">send_password_reset_email()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/services.html#module-app.services.redis">Redis –∫–µ—à—É–≤–∞–Ω–Ω—è</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/services.html#app.services.redis.RedisService"><code class="docutils literal notranslate"><span class="pre">RedisService</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/services.html#module-app.services.cloudinary">Cloudinary —Å–µ—Ä–≤—ñ—Å</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/services.html#app.services.cloudinary.upload_avatar"><code class="docutils literal notranslate"><span class="pre">upload_avatar()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/services.html#app.services.cloudinary.delete_avatar"><code class="docutils literal notranslate"><span class="pre">delete_avatar()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/services.html#module-app.services.cache_utils">Cache —É—Ç–∏–ª—ñ—Ç–∏</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/services.html#app.services.cache_utils.invalidate_user_cache"><code class="docutils literal notranslate"><span class="pre">invalidate_user_cache()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/services.html#id2">–û—Å–Ω–æ–≤–Ω—ñ –∫–ª–∞—Å–∏ —Ç–∞ —Ñ—É–Ω–∫—Ü—ñ—ó</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/services.html#redisservice">RedisService</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/services.html#id9">–§—É–Ω–∫—Ü—ñ—ó Cloudinary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/services.html#id12">Email —Ñ—É–Ω–∫—Ü—ñ—ó</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/utils.html">–£—Ç–∏–ª—ñ—Ç–∏</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/utils.html#module-app.utils.auth">–ê—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è —É—Ç–∏–ª—ñ—Ç–∏</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/utils.html#app.utils.auth.verify_password"><code class="docutils literal notranslate"><span class="pre">verify_password()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/utils.html#app.utils.auth.get_password_hash"><code class="docutils literal notranslate"><span class="pre">get_password_hash()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/utils.html#app.utils.auth.create_access_token"><code class="docutils literal notranslate"><span class="pre">create_access_token()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/utils.html#app.utils.auth.verify_token"><code class="docutils literal notranslate"><span class="pre">verify_token()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/utils.html#app.utils.auth.generate_verification_token"><code class="docutils literal notranslate"><span class="pre">generate_verification_token()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/utils.html#app.utils.auth.generate_reset_password_token"><code class="docutils literal notranslate"><span class="pre">generate_reset_password_token()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/utils.html#app.utils.auth.create_reset_password_token"><code class="docutils literal notranslate"><span class="pre">create_reset_password_token()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/utils.html#app.utils.auth.verify_reset_password_token"><code class="docutils literal notranslate"><span class="pre">verify_reset_password_token()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/utils.html#id3">–û—Å–Ω–æ–≤–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/utils.html#id4">–†–æ–±–æ—Ç–∞ –∑ –ø–∞—Ä–æ–ª—è–º–∏</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/utils.html#jwt">JWT —Ç–æ–∫–µ–Ω–∏</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/utils.html#id8">–¢–æ–∫–µ–Ω–∏ –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—ó</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/index.html#id2">–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç—É</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/models.html">–ú–æ–¥–µ–ª—ñ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/models.html#app.models.users.UserRole"><code class="docutils literal notranslate"><span class="pre">UserRole</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/models.html#app.models.users.UserRole.USER"><code class="docutils literal notranslate"><span class="pre">UserRole.USER</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/models.html#app.models.users.UserRole.ADMIN"><code class="docutils literal notranslate"><span class="pre">UserRole.ADMIN</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/models.html#id0"><code class="docutils literal notranslate"><span class="pre">UserRole.USER</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/models.html#id2"><code class="docutils literal notranslate"><span class="pre">UserRole.ADMIN</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/models.html#app.models.users.User"><code class="docutils literal notranslate"><span class="pre">User</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/models.html#app.models.users.User.id"><code class="docutils literal notranslate"><span class="pre">User.id</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/models.html#app.models.users.User.username"><code class="docutils literal notranslate"><span class="pre">User.username</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/models.html#app.models.users.User.email"><code class="docutils literal notranslate"><span class="pre">User.email</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/models.html#app.models.users.User.hashed_password"><code class="docutils literal notranslate"><span class="pre">User.hashed_password</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/models.html#app.models.users.User.reset_password_token"><code class="docutils literal notranslate"><span class="pre">User.reset_password_token</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/models.html#app.models.users.User.reset_password_expires"><code class="docutils literal notranslate"><span class="pre">User.reset_password_expires</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/models.html#app.models.users.User.avatar_url"><code class="docutils literal notranslate"><span class="pre">User.avatar_url</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/models.html#app.models.users.User.is_verified"><code class="docutils literal notranslate"><span class="pre">User.is_verified</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/models.html#app.models.users.User.role"><code class="docutils literal notranslate"><span class="pre">User.role</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/models.html#app.models.users.User.verification_token"><code class="docutils literal notranslate"><span class="pre">User.verification_token</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/models.html#app.models.users.User.created_at"><code class="docutils literal notranslate"><span class="pre">User.created_at</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/models.html#app.models.users.User.updated_at"><code class="docutils literal notranslate"><span class="pre">User.updated_at</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/models.html#app.models.users.User.contacts"><code class="docutils literal notranslate"><span class="pre">User.contacts</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/models.html#id3"><code class="docutils literal notranslate"><span class="pre">User.contacts</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/models.html#app.models.users.User.is_admin"><code class="docutils literal notranslate"><span class="pre">User.is_admin()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/models.html#app.models.users.User.__repr__"><code class="docutils literal notranslate"><span class="pre">User.__repr__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/models.html#app.models.users.User.to_dict"><code class="docutils literal notranslate"><span class="pre">User.to_dict()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/models.html#enums">–ü–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω—è (Enums)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/models.html#id4"><code class="docutils literal notranslate"><span class="pre">UserRole</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/models.html#id5"><code class="docutils literal notranslate"><span class="pre">UserRole.USER</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/models.html#id6"><code class="docutils literal notranslate"><span class="pre">UserRole.ADMIN</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/models.html#id7"><code class="docutils literal notranslate"><span class="pre">UserRole.USER</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/models.html#id8"><code class="docutils literal notranslate"><span class="pre">UserRole.ADMIN</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/models.html#id9">–û—Å–Ω–æ–≤–Ω—ñ –º–æ–¥–µ–ª—ñ</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/models.html#id10">–ú–æ–¥–µ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/models.html#id11"><code class="docutils literal notranslate"><span class="pre">User</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/models.html#id29">–ú–æ–¥–µ–ª—å –∫–æ–Ω—Ç–∞–∫—Ç—É</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/crud.html">CRUD –æ–ø–µ—Ä–∞—Ü—ñ—ó</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/crud.html#module-app.crud.users">–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ CRUD</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/crud.html#app.crud.users.user_dict_to_model"><code class="docutils literal notranslate"><span class="pre">user_dict_to_model()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/crud.html#app.crud.users.user_model_to_dict"><code class="docutils literal notranslate"><span class="pre">user_model_to_dict()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/crud.html#app.crud.users.get_current_user"><code class="docutils literal notranslate"><span class="pre">get_current_user()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/crud.html#app.crud.users.get_current_verified_user"><code class="docutils literal notranslate"><span class="pre">get_current_verified_user()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/crud.html#app.crud.users.get_current_admin_user"><code class="docutils literal notranslate"><span class="pre">get_current_admin_user()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/crud.html#app.crud.users.require_role"><code class="docutils literal notranslate"><span class="pre">require_role()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/crud.html#app.crud.users.invalidate_user_cache"><code class="docutils literal notranslate"><span class="pre">invalidate_user_cache()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/crud.html#app.crud.users.get_user_by_email"><code class="docutils literal notranslate"><span class="pre">get_user_by_email()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/crud.html#app.crud.users.get_user_by_username"><code class="docutils literal notranslate"><span class="pre">get_user_by_username()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/crud.html#app.crud.users.get_user_by_id"><code class="docutils literal notranslate"><span class="pre">get_user_by_id()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/crud.html#app.crud.users.get_all_users"><code class="docutils literal notranslate"><span class="pre">get_all_users()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/crud.html#app.crud.users.create_user"><code class="docutils literal notranslate"><span class="pre">create_user()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/crud.html#app.crud.users.authenticate_user"><code class="docutils literal notranslate"><span class="pre">authenticate_user()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/crud.html#app.crud.users.verify_user_email"><code class="docutils literal notranslate"><span class="pre">verify_user_email()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/crud.html#app.crud.users.update_user"><code class="docutils literal notranslate"><span class="pre">update_user()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/crud.html#app.crud.users.update_user_role"><code class="docutils literal notranslate"><span class="pre">update_user_role()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/crud.html#app.crud.users.update_user_avatar"><code class="docutils literal notranslate"><span class="pre">update_user_avatar()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/crud.html#app.crud.users.create_password_reset_token"><code class="docutils literal notranslate"><span class="pre">create_password_reset_token()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/crud.html#app.crud.users.reset_user_password"><code class="docutils literal notranslate"><span class="pre">reset_user_password()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/crud.html#app.crud.users.verify_reset_token"><code class="docutils literal notranslate"><span class="pre">verify_reset_token()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/crud.html#id2">–ö–æ–Ω—Ç–∞–∫—Ç–∏ CRUD</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/crud.html#id3">–û—Å–Ω–æ–≤–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/crud.html#id4">–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/crud.html#id0"><code class="docutils literal notranslate"><span class="pre">get_user_by_email()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/crud.html#id5"><code class="docutils literal notranslate"><span class="pre">create_user()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/crud.html#id6"><code class="docutils literal notranslate"><span class="pre">authenticate_user()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/crud.html#id7"><code class="docutils literal notranslate"><span class="pre">verify_user_email()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/crud.html#id8">–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/services.html">–°–µ—Ä–≤—ñ—Å–∏</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/services.html#module-app.services.email">Email —Å–µ—Ä–≤—ñ—Å</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/services.html#app.services.email.send_verification_email"><code class="docutils literal notranslate"><span class="pre">send_verification_email()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/services.html#app.services.email.send_password_reset_email"><code class="docutils literal notranslate"><span class="pre">send_password_reset_email()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/services.html#module-app.services.redis">Redis –∫–µ—à—É–≤–∞–Ω–Ω—è</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/services.html#app.services.redis.RedisService"><code class="docutils literal notranslate"><span class="pre">RedisService</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/services.html#app.services.redis.RedisService.__init__"><code class="docutils literal notranslate"><span class="pre">RedisService.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/services.html#app.services.redis.RedisService.is_connected"><code class="docutils literal notranslate"><span class="pre">RedisService.is_connected()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/services.html#app.services.redis.RedisService.set_user_cache"><code class="docutils literal notranslate"><span class="pre">RedisService.set_user_cache()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/services.html#app.services.redis.RedisService.get_user_cache"><code class="docutils literal notranslate"><span class="pre">RedisService.get_user_cache()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/services.html#app.services.redis.RedisService.delete_user_cache"><code class="docutils literal notranslate"><span class="pre">RedisService.delete_user_cache()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/services.html#app.services.redis.RedisService.clear_all_cache"><code class="docutils literal notranslate"><span class="pre">RedisService.clear_all_cache()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/services.html#module-app.services.cloudinary">Cloudinary —Å–µ—Ä–≤—ñ—Å</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/services.html#app.services.cloudinary.upload_avatar"><code class="docutils literal notranslate"><span class="pre">upload_avatar()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/services.html#app.services.cloudinary.delete_avatar"><code class="docutils literal notranslate"><span class="pre">delete_avatar()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/services.html#module-app.services.cache_utils">Cache —É—Ç–∏–ª—ñ—Ç–∏</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/services.html#app.services.cache_utils.invalidate_user_cache"><code class="docutils literal notranslate"><span class="pre">invalidate_user_cache()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/services.html#id2">–û—Å–Ω–æ–≤–Ω—ñ –∫–ª–∞—Å–∏ —Ç–∞ —Ñ—É–Ω–∫—Ü—ñ—ó</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/services.html#redisservice">RedisService</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/services.html#id0"><code class="docutils literal notranslate"><span class="pre">RedisService</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/services.html#id9">–§—É–Ω–∫—Ü—ñ—ó Cloudinary</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/services.html#id10"><code class="docutils literal notranslate"><span class="pre">upload_avatar()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/services.html#id11"><code class="docutils literal notranslate"><span class="pre">delete_avatar()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/services.html#id12">Email —Ñ—É–Ω–∫—Ü—ñ—ó</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/services.html#id13"><code class="docutils literal notranslate"><span class="pre">send_verification_email()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/services.html#id14"><code class="docutils literal notranslate"><span class="pre">send_password_reset_email()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/utils.html">–£—Ç–∏–ª—ñ—Ç–∏</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/utils.html#module-app.utils.auth">–ê—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è —É—Ç–∏–ª—ñ—Ç–∏</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/utils.html#app.utils.auth.verify_password"><code class="docutils literal notranslate"><span class="pre">verify_password()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/utils.html#app.utils.auth.get_password_hash"><code class="docutils literal notranslate"><span class="pre">get_password_hash()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/utils.html#app.utils.auth.create_access_token"><code class="docutils literal notranslate"><span class="pre">create_access_token()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/utils.html#app.utils.auth.verify_token"><code class="docutils literal notranslate"><span class="pre">verify_token()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/utils.html#app.utils.auth.generate_verification_token"><code class="docutils literal notranslate"><span class="pre">generate_verification_token()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/utils.html#app.utils.auth.generate_reset_password_token"><code class="docutils literal notranslate"><span class="pre">generate_reset_password_token()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/utils.html#app.utils.auth.create_reset_password_token"><code class="docutils literal notranslate"><span class="pre">create_reset_password_token()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/utils.html#app.utils.auth.verify_reset_password_token"><code class="docutils literal notranslate"><span class="pre">verify_reset_password_token()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/utils.html#id3">–û—Å–Ω–æ–≤–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/utils.html#id4">–†–æ–±–æ—Ç–∞ –∑ –ø–∞—Ä–æ–ª—è–º–∏</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/utils.html#id0"><code class="docutils literal notranslate"><span class="pre">get_password_hash()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/utils.html#id5"><code class="docutils literal notranslate"><span class="pre">verify_password()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/utils.html#jwt">JWT —Ç–æ–∫–µ–Ω–∏</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/utils.html#id6"><code class="docutils literal notranslate"><span class="pre">create_access_token()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/utils.html#id7"><code class="docutils literal notranslate"><span class="pre">verify_token()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/utils.html#id8">–¢–æ–∫–µ–Ω–∏ –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—ó</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/utils.html#id9"><code class="docutils literal notranslate"><span class="pre">generate_verification_token()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/utils.html#id10"><code class="docutils literal notranslate"><span class="pre">generate_reset_password_token()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/utils.html#id11"><code class="docutils literal notranslate"><span class="pre">create_reset_password_token()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../modules/utils.html#id12"><code class="docutils literal notranslate"><span class="pre">verify_reset_password_token()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">üõ†Ô∏è –†–æ–∑—Ä–æ–±–∫–∞</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../development/index.html">–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è –¥–ª—è —Ä–æ–∑—Ä–æ–±–Ω–∏–∫—ñ–≤</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../development/setup.html">–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ —Ä–æ–∑—Ä–æ–±–∫–∏</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../development/setup.html#id2">–ü–æ–ø–µ—Ä–µ–¥–Ω—ñ –≤–∏–º–æ–≥–∏</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../development/setup.html#id3">–ö—Ä–æ–∫ 1: –ö–ª–æ–Ω—É–≤–∞–Ω–Ω—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../development/setup.html#id4">–ö—Ä–æ–∫ 2: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../development/setup.html#id5">–ö—Ä–æ–∫ 3: –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../development/setup.html#id6">–ö—Ä–æ–∫ 4: –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω–Ω–∏—Ö —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../development/setup.html#id7">–ö—Ä–æ–∫ 5: –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤—ñ—Å—ñ–≤</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../development/setup.html#id8">–ö—Ä–æ–∫ 6: –í–∏–∫–æ–Ω–∞–Ω–Ω—è –º—ñ–≥—Ä–∞—Ü—ñ–π</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../development/setup.html#id9">–ö—Ä–æ–∫ 7: –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ —Ä–æ–∑—Ä–æ–±–∫–∏</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../development/setup.html#id10">–ö–æ—Ä–∏—Å–Ω—ñ –∫–æ–º–∞–Ω–¥–∏</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../development/setup.html#ide">–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è IDE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../development/setup.html#vs-code">VS Code</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../development/setup.html#pycharm">PyCharm</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../development/testing.html">–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../development/testing.html#id2">–®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../development/testing.html#id3">–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç—ñ–≤</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../development/testing.html#id4">–ü–æ–∫—Ä–∏—Ç—Ç—è —Ç–µ—Å—Ç–∞–º–∏</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../development/testing.html#id5">–ù–∞–ø–∏—Å–∞–Ω–Ω—è —Ç–µ—Å—Ç—ñ–≤</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../development/deployment.html">–î–µ–ø–ª–æ–π</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../development/deployment.html#docker">Docker –¥–µ–ø–ª–æ–π</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../development/deployment.html#id2">–ó–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../development/deployment.html#nginx">Nginx –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../development/deployment.html#id3">–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../development/deployment.html#ssl-tls">SSL/TLS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../development/index.html#id2">–ó–∞–≥–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../development/index.html#id3">–í–∏–º–æ–≥–∏ –¥–æ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ —Ä–æ–∑—Ä–æ–±–∫–∏</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../development/index.html#id4">–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–æ–∑—Ä–æ–±–∫–∏</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../development/setup.html">–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ —Ä–æ–∑—Ä–æ–±–∫–∏</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../development/setup.html#id2">–ü–æ–ø–µ—Ä–µ–¥–Ω—ñ –≤–∏–º–æ–≥–∏</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../development/setup.html#id3">–ö—Ä–æ–∫ 1: –ö–ª–æ–Ω—É–≤–∞–Ω–Ω—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../development/setup.html#id4">–ö—Ä–æ–∫ 2: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../development/setup.html#id5">–ö—Ä–æ–∫ 3: –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../development/setup.html#id6">–ö—Ä–æ–∫ 4: –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω–Ω–∏—Ö —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../development/setup.html#id7">–ö—Ä–æ–∫ 5: –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤—ñ—Å—ñ–≤</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../development/setup.html#id8">–ö—Ä–æ–∫ 6: –í–∏–∫–æ–Ω–∞–Ω–Ω—è –º—ñ–≥—Ä–∞—Ü—ñ–π</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../development/setup.html#id9">–ö—Ä–æ–∫ 7: –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ —Ä–æ–∑—Ä–æ–±–∫–∏</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../development/setup.html#id10">–ö–æ—Ä–∏—Å–Ω—ñ –∫–æ–º–∞–Ω–¥–∏</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../development/setup.html#ide">–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è IDE</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../development/setup.html#vs-code">VS Code</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../development/setup.html#pycharm">PyCharm</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../development/testing.html">–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../development/testing.html#id2">–®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../development/testing.html#id3">–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç—ñ–≤</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../development/testing.html#id4">–ü–æ–∫—Ä–∏—Ç—Ç—è —Ç–µ—Å—Ç–∞–º–∏</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../development/testing.html#id5">–ù–∞–ø–∏—Å–∞–Ω–Ω—è —Ç–µ—Å—Ç—ñ–≤</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../development/deployment.html">–î–µ–ø–ª–æ–π</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../development/deployment.html#docker">Docker –¥–µ–ø–ª–æ–π</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../development/deployment.html#id2">–ó–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../development/deployment.html#nginx">Nginx –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../development/deployment.html#id3">–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../development/deployment.html#ssl-tls">SSL/TLS</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980B9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Contact Management API</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">app.crud.users</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for app.crud.users</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">CRUD –æ–ø–µ—Ä–∞—Ü—ñ—ó –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏.</span>

<span class="sd">–¶–µ–π –º–æ–¥—É–ª—å –º—ñ—Å—Ç–∏—Ç—å —Ñ—É–Ω–∫—Ü—ñ—ó –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è, —á–∏—Ç–∞–Ω–Ω—è, –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è</span>
<span class="sd">–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –≤ —Å–∏—Å—Ç–µ–º—ñ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">Session</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">app.models.users</span><span class="w"> </span><span class="kn">import</span> <span class="n">User</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">app.schemas.users</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserCreate</span><span class="p">,</span> <span class="n">UserRoleUpdate</span><span class="p">,</span> <span class="n">UserUpdate</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">app.utils.auth</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_password_hash</span><span class="p">,</span> <span class="n">verify_password</span><span class="p">,</span> <span class="n">generate_verification_token</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">fastapi</span><span class="w"> </span><span class="kn">import</span> <span class="n">HTTPException</span><span class="p">,</span> <span class="n">Depends</span><span class="p">,</span> <span class="n">status</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">fastapi.security</span><span class="w"> </span><span class="kn">import</span> <span class="n">HTTPBearer</span><span class="p">,</span> <span class="n">HTTPAuthorizationCredentials</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">Session</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">app.api.deps</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_db</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">app.utils.auth</span><span class="w"> </span><span class="kn">import</span> <span class="n">verify_token</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">app.models.users</span><span class="w"> </span><span class="kn">import</span> <span class="n">User</span><span class="p">,</span> <span class="n">UserRole</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">app.services.redis</span><span class="w"> </span><span class="kn">import</span> <span class="n">redis_service</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">app.services.cache_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">invalidate_user_cache</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">security</span> <span class="o">=</span> <span class="n">HTTPBearer</span><span class="p">()</span>

<div class="viewcode-block" id="user_dict_to_model">
<a class="viewcode-back" href="../../../modules/crud.html#app.crud.users.user_dict_to_model">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">user_dict_to_model</span><span class="p">(</span><span class="n">user_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">User</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –ö–æ–Ω–≤–µ—Ä—Ç—É—î —Å–ª–æ–≤–Ω–∏–∫ –≤ –º–æ–¥–µ–ª—å User.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        user_data (dict): –°–ª–æ–≤–Ω–∏–∫ –∑ –¥–∞–Ω–∏–º–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        User: –û–±&#39;—î–∫—Ç –º–æ–¥–µ–ª—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</span>
<span class="sd">        </span>
<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; user_data = {&#39;id&#39;: 1, &#39;email&#39;: &#39;test@example.com&#39;, &#39;role&#39;: &#39;user&#39;}</span>
<span class="sd">        &gt;&gt;&gt; user = user_dict_to_model(user_data)</span>
<span class="sd">        &gt;&gt;&gt; user.email</span>
<span class="sd">        &#39;test@example.com&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">user_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;role&#39;</span><span class="p">:</span>
            <span class="c1"># –ö–æ–Ω–≤–µ—Ä—Ç—É—î–º–æ —Å—Ç—Ä–æ–∫—É –Ω–∞–∑–∞–¥ –≤ enum</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">UserRole</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">value</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">user</span></div>


<div class="viewcode-block" id="user_model_to_dict">
<a class="viewcode-back" href="../../../modules/crud.html#app.crud.users.user_model_to_dict">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">user_model_to_dict</span><span class="p">(</span><span class="n">user</span><span class="p">:</span> <span class="n">User</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –ö–æ–Ω–≤–µ—Ä—Ç—É—î –º–æ–¥–µ–ª—å User –≤ —Å–ª–æ–≤–Ω–∏–∫ –¥–ª—è –∫–µ—à—É–≤–∞–Ω–Ω—è.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        user (User): –û–±&#39;—î–∫—Ç –º–æ–¥–µ–ª—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        dict: –°–ª–æ–≤–Ω–∏–∫ –∑ –¥–∞–Ω–∏–º–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</span>
<span class="sd">        </span>
<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; user = User(id=1, email=&#39;test@example.com&#39;)</span>
<span class="sd">        &gt;&gt;&gt; user_dict = user_model_to_dict(user)</span>
<span class="sd">        &gt;&gt;&gt; user_dict[&#39;email&#39;]</span>
<span class="sd">        &#39;test@example.com&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
        <span class="s1">&#39;email&#39;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span>
        <span class="s1">&#39;hashed_password&#39;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">hashed_password</span><span class="p">,</span>
        <span class="s1">&#39;avatar_url&#39;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">avatar_url</span><span class="p">,</span>
        <span class="s1">&#39;role&#39;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">role</span><span class="o">.</span><span class="n">value</span> <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">role</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;is_verified&#39;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">is_verified</span><span class="p">,</span>
        <span class="s1">&#39;verification_token&#39;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">verification_token</span><span class="p">,</span>
        <span class="s1">&#39;created_at&#39;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">created_at</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span> <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">created_at</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;updated_at&#39;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">updated_at</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span> <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">updated_at</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="p">}</span></div>


<div class="viewcode-block" id="get_current_user">
<a class="viewcode-back" href="../../../modules/crud.html#app.crud.users.get_current_user">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_current_user</span><span class="p">(</span>
    <span class="n">credentials</span><span class="p">:</span> <span class="n">HTTPAuthorizationCredentials</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">security</span><span class="p">),</span>
    <span class="n">db</span><span class="p">:</span> <span class="n">Session</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_db</span><span class="p">)</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">User</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –û—Ç—Ä–∏–º—É—î –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ JWT —Ç–æ–∫–µ–Ω–∞ (–∑ –∫–µ—à—É–≤–∞–Ω–Ω—è–º).</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        credentials (HTTPAuthorizationCredentials): JWT —Ç–æ–∫–µ–Ω</span>
<span class="sd">        db (Session): –°–µ—Å—ñ—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        User: –û–±&#39;—î–∫—Ç –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</span>
<span class="sd">        </span>
<span class="sd">    Raises:</span>
<span class="sd">        HTTPException: 401 —è–∫—â–æ —Ç–æ–∫–µ–Ω –Ω–µ–≤–∞–ª—ñ–¥–Ω–∏–π –∞–±–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∏–π</span>
<span class="sd">        </span>
<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; user = get_current_user(credentials, db)</span>
<span class="sd">        &gt;&gt;&gt; user.email</span>
<span class="sd">        &#39;user@example.com&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">credentials_exception</span> <span class="o">=</span> <span class="n">HTTPException</span><span class="p">(</span>
        <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_401_UNAUTHORIZED</span><span class="p">,</span>
        <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Could not validate credentials&quot;</span><span class="p">,</span>
        <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;WWW-Authenticate&quot;</span><span class="p">:</span> <span class="s2">&quot;Bearer&quot;</span><span class="p">},</span>
    <span class="p">)</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">email</span> <span class="o">=</span> <span class="n">verify_token</span><span class="p">(</span><span class="n">credentials</span><span class="o">.</span><span class="n">credentials</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">email</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">credentials_exception</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">credentials_exception</span>
    
    <span class="c1"># –°–ø—Ä–æ–±—É—î–º–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ –∫–µ—à—É</span>
    <span class="n">cached_user_data</span> <span class="o">=</span> <span class="n">redis_service</span><span class="o">.</span><span class="n">get_user_cache</span><span class="p">(</span><span class="n">email</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cached_user_data</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User </span><span class="si">{</span><span class="n">email</span><span class="si">}</span><span class="s2"> loaded from cache&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">user_dict_to_model</span><span class="p">(</span><span class="n">cached_user_data</span><span class="p">)</span>
    
    <span class="c1"># –Ø–∫—â–æ –Ω–µ–º–∞—î –≤ –∫–µ—à—ñ, –æ—Ç—Ä–∏–º—É—î–º–æ –∑ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User </span><span class="si">{</span><span class="n">email</span><span class="si">}</span><span class="s2"> not in cache, loading from database&quot;</span><span class="p">)</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">get_user_by_email</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">credentials_exception</span>
    
    <span class="c1"># –ö–µ—à—É—î–º–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</span>
    <span class="n">user_data</span> <span class="o">=</span> <span class="n">user_model_to_dict</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
    <span class="n">cache_success</span> <span class="o">=</span> <span class="n">redis_service</span><span class="o">.</span><span class="n">set_user_cache</span><span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="n">user_data</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cache_success</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User </span><span class="si">{</span><span class="n">email</span><span class="si">}</span><span class="s2"> cached successfully&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to cache user </span><span class="si">{</span><span class="n">email</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">user</span></div>


<div class="viewcode-block" id="get_current_verified_user">
<a class="viewcode-back" href="../../../modules/crud.html#app.crud.users.get_current_verified_user">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_current_verified_user</span><span class="p">(</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">User</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">User</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –û—Ç—Ä–∏–º—É—î —Ç—ñ–ª—å–∫–∏ –≤–µ—Ä–∏—Ñ—ñ–∫–æ–≤–∞–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        current_user (User): –ü–æ—Ç–æ—á–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        User: –í–µ—Ä–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á</span>
<span class="sd">        </span>
<span class="sd">    Raises:</span>
<span class="sd">        HTTPException: 400 —è–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–µ –≤–µ—Ä–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π</span>
<span class="sd">        </span>
<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; user = get_current_verified_user(current_user)</span>
<span class="sd">        &gt;&gt;&gt; user.is_verified</span>
<span class="sd">        True</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">current_user</span><span class="o">.</span><span class="n">is_verified</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_400_BAD_REQUEST</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Email not verified&quot;</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">current_user</span></div>


<div class="viewcode-block" id="get_current_admin_user">
<a class="viewcode-back" href="../../../modules/crud.html#app.crud.users.get_current_admin_user">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_current_admin_user</span><span class="p">(</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">User</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_verified_user</span><span class="p">)</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">User</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –û—Ç—Ä–∏–º—É—î —Ç—ñ–ª—å–∫–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ —Ä–æ–ª–ª—é admin.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        current_user (User): –ü–æ—Ç–æ—á–Ω–∏–π –≤–µ—Ä–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        User: –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á-–∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä</span>
<span class="sd">        </span>
<span class="sd">    Raises:</span>
<span class="sd">        HTTPException: 403 —è–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–µ –º–∞—î —Ä–æ–ª—å admin</span>
<span class="sd">        </span>
<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; admin = get_current_admin_user(current_user)</span>
<span class="sd">        &gt;&gt;&gt; admin.role</span>
<span class="sd">        &lt;UserRole.ADMIN: &#39;admin&#39;&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="n">UserRole</span><span class="o">.</span><span class="n">ADMIN</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Admin access required&quot;</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">current_user</span></div>


<div class="viewcode-block" id="require_role">
<a class="viewcode-back" href="../../../modules/crud.html#app.crud.users.require_role">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">require_role</span><span class="p">(</span><span class="n">required_role</span><span class="p">:</span> <span class="n">UserRole</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –î–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ä–æ–ª—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        required_role (UserRole): –ù–µ–æ–±—Ö—ñ–¥–Ω–∞ —Ä–æ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        callable: –§—É–Ω–∫—Ü—ñ—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ä–æ–ª—ñ</span>
<span class="sd">        </span>
<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; @require_role(UserRole.ADMIN)</span>
<span class="sd">        &gt;&gt;&gt; def admin_function(user):</span>
<span class="sd">        ...     return &quot;Admin access granted&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">role_checker</span><span class="p">(</span><span class="n">current_user</span><span class="p">:</span> <span class="n">User</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_verified_user</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="n">User</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="n">required_role</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
                <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
                <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Role &#39;</span><span class="si">{</span><span class="n">required_role</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&#39; required&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">current_user</span>
    <span class="k">return</span> <span class="n">role_checker</span></div>


<div class="viewcode-block" id="invalidate_user_cache">
<a class="viewcode-back" href="../../../modules/crud.html#app.crud.users.invalidate_user_cache">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">invalidate_user_cache</span><span class="p">(</span><span class="n">user_email</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –Ü–Ω–≤–∞–ª—ñ–¥—É—î –∫–µ—à –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (–¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø—ñ—Å–ª—è –æ–Ω–æ–≤–ª–µ–Ω—å).</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        user_email (str): Email –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</span>
<span class="sd">        </span>
<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; invalidate_user_cache(&#39;user@example.com&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">redis_service</span><span class="o">.</span><span class="n">delete_user_cache</span><span class="p">(</span><span class="n">user_email</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cache invalidated for user </span><span class="si">{</span><span class="n">user_email</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_user_by_email">
<a class="viewcode-back" href="../../../modules/crud.html#app.crud.users.get_user_by_email">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_user_by_email</span><span class="p">(</span><span class="n">db</span><span class="p">:</span> <span class="n">Session</span><span class="p">,</span> <span class="n">email</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">User</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –û—Ç—Ä–∏–º—É—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑–∞ email –∞–¥—Ä–µ—Å–æ—é.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        db (Session): –°–µ—Å—ñ—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö</span>
<span class="sd">        email (str): Email –∞–¥—Ä–µ—Å–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        Optional[User]: –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –∞–±–æ None —è–∫—â–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</span>
<span class="sd">        </span>
<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; user = get_user_by_email(db, &#39;user@example.com&#39;)</span>
<span class="sd">        &gt;&gt;&gt; user.email if user else None</span>
<span class="sd">        &#39;user@example.com&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">email</span> <span class="o">==</span> <span class="n">email</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span></div>


<div class="viewcode-block" id="get_user_by_username">
<a class="viewcode-back" href="../../../modules/crud.html#app.crud.users.get_user_by_username">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_user_by_username</span><span class="p">(</span><span class="n">db</span><span class="p">:</span> <span class="n">Session</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">User</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –û—Ç—Ä–∏–º—É—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑–∞ —ñ–º–µ–Ω–µ–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        db (Session): –°–µ—Å—ñ—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö</span>
<span class="sd">        username (str): –Ü–º&#39;—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        Optional[User]: –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –∞–±–æ None —è–∫—â–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</span>
<span class="sd">        </span>
<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; user = get_user_by_username(db, &#39;testuser&#39;)</span>
<span class="sd">        &gt;&gt;&gt; user.username if user else None</span>
<span class="sd">        &#39;testuser&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span> <span class="o">==</span> <span class="n">username</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span></div>


<div class="viewcode-block" id="get_user_by_id">
<a class="viewcode-back" href="../../../modules/crud.html#app.crud.users.get_user_by_id">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_user_by_id</span><span class="p">(</span><span class="n">db</span><span class="p">:</span> <span class="n">Session</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">User</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –û—Ç—Ä–∏–º—É—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑–∞ ID.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        db (Session): –°–µ—Å—ñ—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö</span>
<span class="sd">        user_id (int): ID –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        Optional[User]: –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –∞–±–æ None —è–∫—â–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</span>
<span class="sd">        </span>
<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; user = get_user_by_id(db, 1)</span>
<span class="sd">        &gt;&gt;&gt; user.id if user else None</span>
<span class="sd">        1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">user_id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span></div>


<div class="viewcode-block" id="get_all_users">
<a class="viewcode-back" href="../../../modules/crud.html#app.crud.users.get_all_users">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_all_users</span><span class="p">(</span><span class="n">db</span><span class="p">:</span> <span class="n">Session</span><span class="p">,</span> <span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">User</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –û—Ç—Ä–∏–º—É—î –≤—Å—ñ—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ (—Ç—ñ–ª—å–∫–∏ –¥–ª—è –∞–¥–º—ñ–Ω—ñ–≤).</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        db (Session): –°–µ—Å—ñ—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö</span>
<span class="sd">        skip (int): –ö—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–ø–∏—Å—ñ–≤ –¥–ª—è –ø—Ä–æ–ø—É—Å–∫—É</span>
<span class="sd">        limit (int): –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–ø–∏—Å—ñ–≤</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        List[User]: –°–ø–∏—Å–æ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</span>
<span class="sd">        </span>
<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; users = get_all_users(db, skip=0, limit=10)</span>
<span class="sd">        &gt;&gt;&gt; len(users)</span>
<span class="sd">        5</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">offset</span><span class="p">(</span><span class="n">skip</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="n">limit</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></div>


<div class="viewcode-block" id="create_user">
<a class="viewcode-back" href="../../../modules/crud.html#app.crud.users.create_user">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">create_user</span><span class="p">(</span><span class="n">db</span><span class="p">:</span> <span class="n">Session</span><span class="p">,</span> <span class="n">user</span><span class="p">:</span> <span class="n">UserCreate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">User</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –°—Ç–≤–æ—Ä—é—î –Ω–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤ —Å–∏—Å—Ç–µ–º—ñ.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        db (Session): –°–µ—Å—ñ—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö</span>
<span class="sd">        user (UserCreate): –î–∞–Ω—ñ –Ω–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        User: –°—Ç–≤–æ—Ä–µ–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á</span>
<span class="sd">        </span>
<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; user_data = UserCreate(</span>
<span class="sd">        ...     username=&#39;newuser&#39;,</span>
<span class="sd">        ...     email=&#39;new@example.com&#39;,</span>
<span class="sd">        ...     password=&#39;password123&#39;</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; new_user = create_user(db, user_data)</span>
<span class="sd">        &gt;&gt;&gt; new_user.email</span>
<span class="sd">        &#39;new@example.com&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">hashed_password</span> <span class="o">=</span> <span class="n">get_password_hash</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">password</span><span class="p">)</span>
    <span class="n">verification_token</span> <span class="o">=</span> <span class="n">generate_verification_token</span><span class="p">()</span>
    
    <span class="n">db_user</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span>
        <span class="n">username</span><span class="o">=</span><span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
        <span class="n">email</span><span class="o">=</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span>
        <span class="n">hashed_password</span><span class="o">=</span><span class="n">hashed_password</span><span class="p">,</span>
        <span class="n">role</span><span class="o">=</span><span class="n">user</span><span class="o">.</span><span class="n">role</span><span class="p">,</span>
        <span class="n">verification_token</span><span class="o">=</span><span class="n">verification_token</span>
    <span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">db_user</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="n">db</span><span class="o">.</span><span class="n">refresh</span><span class="p">(</span><span class="n">db_user</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">db_user</span></div>


<div class="viewcode-block" id="authenticate_user">
<a class="viewcode-back" href="../../../modules/crud.html#app.crud.users.authenticate_user">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">authenticate_user</span><span class="p">(</span><span class="n">db</span><span class="p">:</span> <span class="n">Session</span><span class="p">,</span> <span class="n">email</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">User</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –ê—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫—É—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑–∞ email —Ç–∞ –ø–∞—Ä–æ–ª–µ–º.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        db (Session): –°–µ—Å—ñ—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö</span>
<span class="sd">        email (str): Email –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</span>
<span class="sd">        password (str): –ü–∞—Ä–æ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        Optional[User]: –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á —è–∫—â–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è —É—Å–ø—ñ—à–Ω–∞, —ñ–Ω–∞–∫—à–µ None</span>
<span class="sd">        </span>
<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; user = authenticate_user(db, &#39;user@example.com&#39;, &#39;password123&#39;)</span>
<span class="sd">        &gt;&gt;&gt; user.email if user else None</span>
<span class="sd">        &#39;user@example.com&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">get_user_by_email</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">email</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">verify_password</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="n">user</span><span class="o">.</span><span class="n">hashed_password</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">user</span></div>


<div class="viewcode-block" id="verify_user_email">
<a class="viewcode-back" href="../../../modules/crud.html#app.crud.users.verify_user_email">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">verify_user_email</span><span class="p">(</span><span class="n">db</span><span class="p">:</span> <span class="n">Session</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –í–µ—Ä–∏—Ñ—ñ–∫—É—î email –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑–∞ —Ç–æ–∫–µ–Ω–æ–º.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        db (Session): –°–µ—Å—ñ—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö</span>
<span class="sd">        token (str): –¢–æ–∫–µ–Ω –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—ó</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        bool: True —è–∫—â–æ –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—è —É—Å–ø—ñ—à–Ω–∞, False —ñ–Ω–∞–∫—à–µ</span>
<span class="sd">        </span>
<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; success = verify_user_email(db, &#39;verification_token_123&#39;)</span>
<span class="sd">        &gt;&gt;&gt; success</span>
<span class="sd">        True</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">verification_token</span> <span class="o">==</span> <span class="n">token</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    
    <span class="n">user</span><span class="o">.</span><span class="n">is_verified</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">user</span><span class="o">.</span><span class="n">verification_token</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="update_user">
<a class="viewcode-back" href="../../../modules/crud.html#app.crud.users.update_user">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">update_user</span><span class="p">(</span><span class="n">db</span><span class="p">:</span> <span class="n">Session</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">user_update</span><span class="p">:</span> <span class="n">UserUpdate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">User</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –û–Ω–æ–≤–ª—é—î –¥–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        db (Session): –°–µ—Å—ñ—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö</span>
<span class="sd">        user_id (int): ID –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</span>
<span class="sd">        user_update (UserUpdate): –ù–æ–≤—ñ –¥–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        Optional[User]: –û–Ω–æ–≤–ª–µ–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∞–±–æ None —è–∫—â–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</span>
<span class="sd">        </span>
<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; update_data = UserUpdate(username=&#39;newusername&#39;)</span>
<span class="sd">        &gt;&gt;&gt; updated_user = update_user(db, 1, update_data)</span>
<span class="sd">        &gt;&gt;&gt; updated_user.username if updated_user else None</span>
<span class="sd">        &#39;newusername&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">get_user_by_id</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    
    <span class="n">update_data</span> <span class="o">=</span> <span class="n">user_update</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">exclude_unset</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">field</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">update_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    
    <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="n">db</span><span class="o">.</span><span class="n">refresh</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">user</span></div>


<div class="viewcode-block" id="update_user_role">
<a class="viewcode-back" href="../../../modules/crud.html#app.crud.users.update_user_role">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">update_user_role</span><span class="p">(</span><span class="n">db</span><span class="p">:</span> <span class="n">Session</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">role_update</span><span class="p">:</span> <span class="n">UserRoleUpdate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">User</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –û–Ω–æ–≤–ª—é—î —Ä–æ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (—Ç—ñ–ª—å–∫–∏ –¥–ª—è –∞–¥–º—ñ–Ω—ñ–≤).</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        db (Session): –°–µ—Å—ñ—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö</span>
<span class="sd">        user_id (int): ID –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</span>
<span class="sd">        role_update (UserRoleUpdate): –ù–æ–≤–∞ —Ä–æ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        Optional[User]: –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑ –æ–Ω–æ–≤–ª–µ–Ω–æ—é —Ä–æ–ª–ª—é –∞–±–æ None —è–∫—â–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</span>
<span class="sd">        </span>
<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; role_data = UserRoleUpdate(role=UserRole.ADMIN)</span>
<span class="sd">        &gt;&gt;&gt; updated_user = update_user_role(db, 1, role_data)</span>
<span class="sd">        &gt;&gt;&gt; updated_user.role if updated_user else None</span>
<span class="sd">        &lt;UserRole.ADMIN: &#39;admin&#39;&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">get_user_by_id</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    
    <span class="n">user</span><span class="o">.</span><span class="n">role</span> <span class="o">=</span> <span class="n">role_update</span><span class="o">.</span><span class="n">role</span>
    <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="n">db</span><span class="o">.</span><span class="n">refresh</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">user</span></div>


<div class="viewcode-block" id="update_user_avatar">
<a class="viewcode-back" href="../../../modules/crud.html#app.crud.users.update_user_avatar">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">update_user_avatar</span><span class="p">(</span><span class="n">db</span><span class="p">:</span> <span class="n">Session</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">avatar_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">User</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –û–Ω–æ–≤–ª—é—î –∞–≤–∞—Ç–∞—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        db (Session): –°–µ—Å—ñ—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö</span>
<span class="sd">        user_id (int): ID –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</span>
<span class="sd">        avatar_url (str): URL –Ω–æ–≤–æ–≥–æ –∞–≤–∞—Ç–∞—Ä–∞</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        Optional[User]: –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑ –æ–Ω–æ–≤–ª–µ–Ω–∏–º –∞–≤–∞—Ç–∞—Ä–æ–º –∞–±–æ None —è–∫—â–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</span>
<span class="sd">        </span>
<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; updated_user = update_user_avatar(db, 1, &#39;https://example.com/avatar.jpg&#39;)</span>
<span class="sd">        &gt;&gt;&gt; updated_user.avatar_url if updated_user else None</span>
<span class="sd">        &#39;https://example.com/avatar.jpg&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">get_user_by_id</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    
    <span class="n">user</span><span class="o">.</span><span class="n">avatar_url</span> <span class="o">=</span> <span class="n">avatar_url</span>
    <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="n">db</span><span class="o">.</span><span class="n">refresh</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">user</span></div>


<div class="viewcode-block" id="create_password_reset_token">
<a class="viewcode-back" href="../../../modules/crud.html#app.crud.users.create_password_reset_token">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">create_password_reset_token</span><span class="p">(</span><span class="n">db</span><span class="p">:</span> <span class="n">Session</span><span class="p">,</span> <span class="n">email</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">User</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –°—Ç–≤–æ—Ä—é—î —Ç–æ–∫–µ–Ω –¥–ª—è —Å–∫–∏–¥–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—è.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        db (Session): –°–µ—Å—ñ—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö</span>
<span class="sd">        email (str): Email –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        Optional[User]: –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑ —Ç–æ–∫–µ–Ω–æ–º —Å–∫–∏–¥–∞–Ω–Ω—è –∞–±–æ None —è–∫—â–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</span>
<span class="sd">        </span>
<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; user = create_password_reset_token(db, &#39;user@example.com&#39;)</span>
<span class="sd">        &gt;&gt;&gt; user.reset_password_token is not None if user else False</span>
<span class="sd">        True</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">app.utils.auth</span><span class="w"> </span><span class="kn">import</span> <span class="n">generate_reset_password_token</span>
    
    <span class="n">user</span> <span class="o">=</span> <span class="n">get_user_by_email</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">email</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    
    <span class="c1"># –ì–µ–Ω–µ—Ä—É—î–º–æ —Ç–æ–∫–µ–Ω —Ç–∞ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ —á–∞—Å –∑–∞–∫—ñ–Ω—á–µ–Ω–Ω—è (1 –≥–æ–¥–∏–Ω–∞)</span>
    <span class="n">reset_token</span> <span class="o">=</span> <span class="n">generate_reset_password_token</span><span class="p">()</span>
    <span class="n">expires_at</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">())</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="n">user</span><span class="o">.</span><span class="n">reset_password_token</span> <span class="o">=</span> <span class="n">reset_token</span>
    <span class="n">user</span><span class="o">.</span><span class="n">reset_password_expires</span> <span class="o">=</span> <span class="n">expires_at</span>
    
    <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="n">db</span><span class="o">.</span><span class="n">refresh</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">user</span></div>


<div class="viewcode-block" id="reset_user_password">
<a class="viewcode-back" href="../../../modules/crud.html#app.crud.users.reset_user_password">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">reset_user_password</span><span class="p">(</span><span class="n">db</span><span class="p">:</span> <span class="n">Session</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">new_password</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">User</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –°–∫–∏–¥–∞—î –ø–∞—Ä–æ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑–∞ —Ç–æ–∫–µ–Ω–æ–º.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        db (Session): –°–µ—Å—ñ—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö</span>
<span class="sd">        token (str): –¢–æ–∫–µ–Ω —Å–∫–∏–¥–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—è</span>
<span class="sd">        new_password (str): –ù–æ–≤–∏–π –ø–∞—Ä–æ–ª—å</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        Optional[User]: –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑ –æ–Ω–æ–≤–ª–µ–Ω–∏–º –ø–∞—Ä–æ–ª–µ–º –∞–±–æ None —è–∫—â–æ —Ç–æ–∫–µ–Ω –Ω–µ–≤–∞–ª—ñ–¥–Ω–∏–π</span>
<span class="sd">        </span>
<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; user = reset_user_password(db, &#39;reset_token_123&#39;, &#39;newpassword&#39;)</span>
<span class="sd">        &gt;&gt;&gt; user.reset_password_token is None if user else False</span>
<span class="sd">        True</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
        <span class="n">User</span><span class="o">.</span><span class="n">reset_password_token</span> <span class="o">==</span> <span class="n">token</span><span class="p">,</span>
        <span class="n">User</span><span class="o">.</span><span class="n">reset_password_expires</span> <span class="o">&gt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
    <span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    
    <span class="c1"># –û–Ω–æ–≤–ª—é—î–º–æ –ø–∞—Ä–æ–ª—å —Ç–∞ –æ—á–∏—â–∞—î–º–æ —Ç–æ–∫–µ–Ω</span>
    <span class="n">user</span><span class="o">.</span><span class="n">hashed_password</span> <span class="o">=</span> <span class="n">get_password_hash</span><span class="p">(</span><span class="n">new_password</span><span class="p">)</span>
    <span class="n">user</span><span class="o">.</span><span class="n">reset_password_token</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">user</span><span class="o">.</span><span class="n">reset_password_expires</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="n">db</span><span class="o">.</span><span class="n">refresh</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">user</span></div>


<div class="viewcode-block" id="verify_reset_token">
<a class="viewcode-back" href="../../../modules/crud.html#app.crud.users.verify_reset_token">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">verify_reset_token</span><span class="p">(</span><span class="n">db</span><span class="p">:</span> <span class="n">Session</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">User</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –ü–µ—Ä–µ–≤—ñ—Ä—è—î –≤–∞–ª—ñ–¥–Ω—ñ—Å—Ç—å —Ç–æ–∫–µ–Ω–∞ —Å–∫–∏–¥–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—è.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        db (Session): –°–µ—Å—ñ—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö</span>
<span class="sd">        token (str): –¢–æ–∫–µ–Ω —Å–∫–∏–¥–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—è</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        Optional[User]: –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á —è–∫—â–æ —Ç–æ–∫–µ–Ω –≤–∞–ª—ñ–¥–Ω–∏–π, —ñ–Ω–∞–∫—à–µ None</span>
<span class="sd">        </span>
<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; user = verify_reset_token(db, &#39;reset_token_123&#39;)</span>
<span class="sd">        &gt;&gt;&gt; user.email if user else None</span>
<span class="sd">        &#39;user@example.com&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
        <span class="n">User</span><span class="o">.</span><span class="n">reset_password_token</span> <span class="o">==</span> <span class="n">token</span><span class="p">,</span>
        <span class="n">User</span><span class="o">.</span><span class="n">reset_password_expires</span> <span class="o">&gt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
    <span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Contact Management Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>